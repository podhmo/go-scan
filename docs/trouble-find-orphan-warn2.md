# Analysis of "expected multi-return value on RHS of assignment" Warning

This document details the cause of a specific warning message generated by the `symgo` symbolic execution engine.

## The Warning

During analysis, the following warning messages may be observed:

```log
time=2025-08-29T21:07:01.564+09:00 level=WARN msg="expected multi-return value on RHS of assignment" got_type=SYMBOLIC_PLACEHOLDER
time=2025-08-29T21:07:01.564+09:00 level=WARN msg="expected multi-return value on RHS of assignment" got_type=SYMBOLIC_PLACEHOLDER
```

This warning was seen when analyzing code with a structure similar to this:

```go
// ShouldBeSame is a simplified example
func ShouldBeSame(
	lsrc func() (any, []byte, error),
	rsrc func() (any, []byte, error),
) error {
	// ...
	lv, lb, err := lsrc()
	if err != nil {
		// ...
	}
	rv, rb, err := rsrc()
	if err != nil {
		// ...
	}
    // ...
	return nil
}
```

## Root Cause Analysis

The warning originates from the `symgo/evaluator/evaluator.go` file within the `evalAssignStmt` function. This function is responsible for symbolically executing assignment statements (`=` and `:=`).

The specific logic that triggers the warning is designed to handle multi-value assignments, such as `x, y, z := myFunction()`.

1.  **Expectation**: When the evaluator encounters this pattern, it first evaluates the right-hand side (RHS), `myFunction()`. It expects the result of this evaluation to be a special internal object called `*object.MultiReturn`, which acts as a container for the multiple values.

2.  **The `lsrc()` and `rsrc()` Case**: In the example code, the functions being called (`lsrc` and `rsrc`) are not concrete, defined functions that `symgo` can analyze. Instead, they are parameters passed into `ShouldBeSame`. The symbolic execution engine cannot know what the actual implementation of `lsrc` or `rsrc` will be at analysis time.

3.  **Symbolic Placeholder**: Because `symgo` cannot execute the function call and get concrete return values, it treats the function as a "black box". The result of evaluating the call `lsrc()` is not a `*object.MultiReturn` container. Instead, it is a `*object.SymbolicPlaceholder`. This placeholder is an opaque object representing the unknown result of the function call.

4.  **Type Mismatch and Warning**: The `evalAssignStmt` function checks if the result from the RHS is of the expected `*object.MultiReturn` type. When it receives a `*object.SymbolicPlaceholder` instead, this check fails. This failure is the direct cause of the warning log. The `got_type=SYMBOLIC_PLACEHOLDER` field in the log message explicitly confirms this scenario.

5.  **Fallback Behavior**: After logging the warning, the evaluator proceeds with a safe fallback strategy. It assigns a new, distinct `*object.SymbolicPlaceholder` to each of the variables on the left-hand side (`lv`, `lb`, and `err`). This allows the analysis to continue without crashing, even though the precise values are unknown.

## Conclusion

The warning is not indicative of a bug or an error in the `symgo` engine. It is an intentional, informative message that highlights a specific limitation of static analysis: the inability to know the implementation of a function that is passed as a variable (a higher-order function).

The engine correctly identifies the situation, logs it for debugging and visibility, and then proceeds with a valid symbolic representation. This behavior is fundamental to how `symgo` handles code that it cannot fully resolve or introspect.
